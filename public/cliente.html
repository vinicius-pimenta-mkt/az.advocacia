<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil do Cliente - Sistema de Gest√£o de Advocacia</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      color: #B8860B;
      font-size: 28px;
    }

    .back-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #D4A574 0%, #B8860B 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(212, 165, 116, 0.4);
    }

    /* Tabs */
    .tabs {
      display: flex;
      background: white;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    .tab {
      padding: 15px 20px;
      cursor: pointer;
      border: none;
      background: none;
      color: #666;
      font-weight: 600;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .tab:hover {
      color: #D4A574;
    }

    .tab.active {
      color: #D4A574;
      border-bottom-color: #D4A574;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .tab-content.active {
      display: block;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .info-card {
      background: #FFF8DC;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #D4A574;
    }

    .info-label {
      color: #666;
      font-size: 12px;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .info-value {
      color: #B8860B;
      font-size: 16px;
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th {
      background: #FFF8DC;
      color: #B8860B;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #F0E68C;
      font-size: 13px;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #e0e0e0;
    }

    tr:hover {
      background: #f9fafb;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-ativo {
      background: #C8E6C9;
      color: #2E7D32;
    }

    .status-novo {
      background: #FFF8DC;
      color: #B8860B;
    }

    .status-pendente {
      background: #FFE0B2;
      color: #E65100;
    }

    .status-concluido {
      background: #E1BEE7;
      color: #6A1B9A;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: linear-gradient(135deg, #D4A574 0%, #B8860B 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(212, 165, 116, 0.4);
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .timeline {
      position: relative;
      padding: 20px 0;
    }

    .timeline-item {
      display: flex;
      margin-bottom: 20px;
      position: relative;
      padding-left: 40px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 12px;
      height: 12px;
      background: #D4A574;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 0 2px #D4A574;
    }

    .timeline-item::after {
      content: '';
      position: absolute;
      left: 5px;
      top: 12px;
      width: 2px;
      height: calc(100% + 8px);
      background: #ddd;
    }

    .timeline-item:last-child::after {
      display: none;
    }

    .timeline-content {
      background: #FFF8DC;
      padding: 15px;
      border-radius: 8px;
      flex: 1;
    }

    .timeline-date {
      color: #666;
      font-size: 12px;
      margin-bottom: 5px;
    }

    .timeline-text {
      color: #B8860B;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .timeline-description {
      color: #666;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      color: #B8860B;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: inherit;
      font-size: 14px;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #D4A574;
      box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.1);
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .header h1 {
        font-size: 20px;
      }

      .tabs {
        overflow-x: auto;
      }

      .tab {
        padding: 12px 15px;
        font-size: 12px;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 12px;
      }

      td, th {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div>
        <h1 id="clienteName">Cliente</h1>
      </div>
      <button class="back-btn" onclick="goBack()">‚Üê Voltar</button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('resumo')">üìã Resumo</button>
      <button class="tab" onclick="switchTab('situacao')">üìä Situa√ß√£o</button>
      <button class="tab" onclick="switchTab('conversa')">üí¨ √öltima Conversa</button>
      <button class="tab" onclick="switchTab('documentos')">üìÑ Documentos</button>
      <button class="tab" onclick="switchTab('processos')">‚öñÔ∏è Processos</button>
      <button class="tab" onclick="switchTab('pagamentos')">üí∞ Pagamentos</button>
      <button class="tab" onclick="switchTab('contatos')">üìû Contatos</button>
    </div>

    <!-- Tab Contents -->

    <!-- Resumo -->
    <div id="resumo" class="tab-content active">
      <h2>Resumo do Cliente</h2>
      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">Nome</div>
          <div class="info-value" id="resumoNome">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">Email</div>
          <div class="info-value" id="resumoEmail">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">Telefone</div>
          <div class="info-value" id="resumoTelefone">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">WhatsApp</div>
          <div class="info-value" id="resumoWhatsapp">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">CPF/CNPJ</div>
          <div class="info-value" id="resumoCpf">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">Status</div>
          <div class="info-value"><span class="status-badge status-ativo" id="resumoStatus">ativo</span></div>
        </div>
      </div>

      <h3 style="margin-top: 30px; color: #001a4d;">Endere√ßo</h3>
      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">Endere√ßo</div>
          <div class="info-value" id="resumoEndereco">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">Cidade</div>
          <div class="info-value" id="resumoCidade">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">Estado</div>
          <div class="info-value" id="resumoEstado">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">CEP</div>
          <div class="info-value" id="resumoCep">-</div>
        </div>
      </div>

      <h3 style="margin-top: 30px; color: #001a4d;">Observa√ß√µes</h3>
      <div style="background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 4px solid #0052cc;">
        <p id="resumoObservacoes" style="color: #666;">-</p>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="editarCliente()">Editar Cliente</button>
      </div>
    </div>

    <!-- Situa√ß√£o -->
    <div id="situacao" class="tab-content">
      <h2>Situa√ß√£o do Cliente</h2>
      <div class="timeline" id="situacaoTimeline">
        <div class="empty-state">
          <div class="empty-state-icon">üìã</div>
          <p>Nenhuma atualiza√ß√£o de situa√ß√£o ainda</p>
        </div>
      </div>

      <h3 style="margin-top: 30px; color: #001a4d;">Adicionar Atualiza√ß√£o</h3>
      <form onsubmit="saveSituacao(event)">
        <div class="form-group">
          <label>Resumo da Situa√ß√£o *</label>
          <input type="text" id="situacaoResumo" placeholder="Ex: Aguardando documenta√ß√£o..." required>
        </div>
        <div class="form-group">
          <label>Descri√ß√£o Detalhada</label>
          <textarea id="situacaoDescricao" placeholder="Descreva a situa√ß√£o atual do cliente..."></textarea>
        </div>
        <div class="btn-group">
          <button type="submit" class="btn btn-primary">Publicar Atualiza√ß√£o</button>
        </div>
      </form>
    </div>

    <!-- √öltima Conversa -->
    <div id="conversa" class="tab-content">
      <h2>√öltima Conversa</h2>
      <div id="conversaContent">
        <div class="empty-state">
          <div class="empty-state-icon">üí¨</div>
          <p>Nenhuma conversa registrada</p>
        </div>
      </div>
    </div>

    <!-- Documentos -->
    <div id="documentos" class="tab-content">
      <h2>Documentos</h2>
      <table>
        <thead>
          <tr>
            <th>T√≠tulo</th>
            <th>Categoria</th>
            <th>Data</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="documentosTable">
          <tr>
            <td colspan="4" style="text-align: center;">Carregando...</td>
          </tr>
        </tbody>
      </table>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="uploadDocumento()">+ Upload Documento</button>
      </div>
    </div>

    <!-- Processos -->
    <div id="processos" class="tab-content">
      <h2>Processos Judiciais</h2>
      <table>
        <thead>
          <tr>
            <th>N√∫mero</th>
            <th>Vara</th>
            <th>Comarca</th>
            <th>Status</th>
            <th>Data In√≠cio</th>
          </tr>
        </thead>
        <tbody id="processosTable">
          <tr>
            <td colspan="5" style="text-align: center;">Carregando...</td>
          </tr>
        </tbody>
      </table>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="novoProcesso()">+ Novo Processo</button>
      </div>
    </div>

    <!-- Pagamentos -->
    <div id="pagamentos" class="tab-content">
      <h2>Faturas e Pagamentos</h2>
      <table>
        <thead>
          <tr>
            <th>N√∫mero</th>
            <th>Valor</th>
            <th>Vencimento</th>
            <th>Status</th>
            <th>Data Pagamento</th>
          </tr>
        </thead>
        <tbody id="pagamentosTable">
          <tr>
            <td colspan="5" style="text-align: center;">Carregando...</td>
          </tr>
        </tbody>
      </table>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="novaFatura()">+ Nova Fatura</button>
      </div>
    </div>

    <!-- Contatos -->
    <div id="contatos" class="tab-content">
      <h2>Contatos Adicionais</h2>
      <table>
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Label</th>
            <th>Valor</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="contatosTable">
          <tr>
            <td colspan="4" style="text-align: center;">Carregando...</td>
          </tr>
        </tbody>
      </table>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="novoContato()">+ Novo Contato</button>
      </div>
    </div>
  </div>

  <script>
    const token = localStorage.getItem('token');
    const API_URL = 'http://localhost:3000/api';
    const urlParams = new URLSearchParams(window.location.search);
    const clienteId = urlParams.get('id');

    if (!token) {
      window.location.href = '/login.html';
    }

    if (!clienteId) {
      alert('Cliente n√£o encontrado');
      window.location.href = '/dashboard.html';
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadCliente();
      loadDocumentos();
      loadProcessos();
      loadPagamentos();
      loadContatos();
      loadSituacao();
    });

    async function loadCliente() {
      try {
        const response = await fetch(`${API_URL}/clientes/${clienteId}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) throw new Error('Cliente n√£o encontrado');

        const cliente = await response.json();

        document.getElementById('clienteName').textContent = cliente.nome;
        document.getElementById('resumoNome').textContent = cliente.nome;
        document.getElementById('resumoEmail').textContent = cliente.email || '-';
        document.getElementById('resumoTelefone').textContent = cliente.telefone || '-';
        document.getElementById('resumoWhatsapp').textContent = cliente.whatsapp || '-';
        document.getElementById('resumoCpf').textContent = cliente.cpf_cnpj || '-';
        document.getElementById('resumoStatus').textContent = cliente.status;
        document.getElementById('resumoEndereco').textContent = cliente.endereco || '-';
        document.getElementById('resumoCidade').textContent = cliente.cidade || '-';
        document.getElementById('resumoEstado').textContent = cliente.estado || '-';
        document.getElementById('resumoCep').textContent = cliente.cep || '-';
        document.getElementById('resumoObservacoes').textContent = cliente.observacoes || 'Sem observa√ß√µes';

      } catch (error) {
        alert('Erro ao carregar cliente: ' + error.message);
      }
    }

    async function loadDocumentos() {
      try {
        const response = await fetch(`${API_URL}/documentos/cliente/${clienteId}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) throw new Error('Erro ao carregar documentos');

        const documentos = await response.json();

        const html = documentos
          .map(d => `
            <tr>
              <td><strong>${d.titulo}</strong></td>
              <td>${d.categoria || '-'}</td>
              <td>${new Date(d.created_at).toLocaleDateString('pt-BR')}</td>
              <td>
                <button class="btn btn-secondary btn-small" onclick="downloadDocumento('${d.id}')">Download</button>
              </td>
            </tr>
          `).join('');

        document.getElementById('documentosTable').innerHTML = html || '<tr><td colspan="4" style="text-align: center;">Nenhum documento</td></tr>';

      } catch (error) {
        console.error('Erro:', error);
      }
    }

    async function loadProcessos() {
      try {
        const response = await fetch(`${API_URL}/processos?cliente_id=${clienteId}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) throw new Error('Erro ao carregar processos');

        const processos = await response.json();

        const html = processos
          .map(p => `
            <tr>
              <td><strong>${p.numero_processo}</strong></td>
              <td>${p.vara || '-'}</td>
              <td>${p.comarca || '-'}</td>
              <td><span class="status-badge status-${p.status}">${p.status}</span></td>
              <td>${new Date(p.data_inicio).toLocaleDateString('pt-BR')}</td>
            </tr>
          `).join('');

        document.getElementById('processosTable').innerHTML = html || '<tr><td colspan="5" style="text-align: center;">Nenhum processo</td></tr>';

      } catch (error) {
        console.error('Erro:', error);
      }
    }

    async function loadPagamentos() {
      try {
        const response = await fetch(`${API_URL}/relatorios/dashboard`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) throw new Error('Erro ao carregar pagamentos');

        const data = await response.json();
        const faturas = (data.faturas || []).filter(f => f.cliente_id === clienteId);

        const html = faturas
          .map(f => `
            <tr>
              <td><strong>${f.numero_fatura}</strong></td>
              <td>R$ ${f.valor.toFixed(2)}</td>
              <td>${new Date(f.data_vencimento).toLocaleDateString('pt-BR')}</td>
              <td><span class="status-badge status-${f.status}">${f.status}</span></td>
              <td>${f.data_pagamento ? new Date(f.data_pagamento).toLocaleDateString('pt-BR') : '-'}</td>
            </tr>
          `).join('');

        document.getElementById('pagamentosTable').innerHTML = html || '<tr><td colspan="5" style="text-align: center;">Nenhuma fatura</td></tr>';

      } catch (error) {
        console.error('Erro:', error);
      }
    }

    async function loadContatos() {
      try {
        const response = await fetch(`${API_URL}/relatorios/dashboard`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) throw new Error('Erro ao carregar contatos');

        const data = await response.json();
        const contatos = (data.contatos || []).filter(c => c.cliente_id === clienteId);

        const html = contatos
          .map(c => `
            <tr>
              <td>${c.tipo}</td>
              <td>${c.label || '-'}</td>
              <td>${c.valor}</td>
              <td>
                <button class="btn btn-secondary btn-small" onclick="deleteContato('${c.id}')">Deletar</button>
              </td>
            </tr>
          `).join('');

        document.getElementById('contatosTable').innerHTML = html || '<tr><td colspan="4" style="text-align: center;">Nenhum contato adicional</td></tr>';

      } catch (error) {
        console.error('Erro:', error);
      }
    }

    async function loadSituacao() {
      try {
        const response = await fetch(`${API_URL}/relatorios/dashboard`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) throw new Error('Erro ao carregar situa√ß√£o');

        const data = await response.json();
        const situacoes = (data.situacoes || []).filter(s => s.cliente_id === clienteId).slice(0, 8);

        const html = situacoes
          .map(s => `
            <div class="timeline-item">
              <div class="timeline-content">
                <div class="timeline-date">${new Date(s.created_at).toLocaleDateString('pt-BR')}</div>
                <div class="timeline-text">${s.resumo}</div>
                <div class="timeline-description">${s.descricao || ''}</div>
              </div>
            </div>
          `).join('');

        document.getElementById('situacaoTimeline').innerHTML = html || `
          <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <p>Nenhuma atualiza√ß√£o de situa√ß√£o ainda</p>
          </div>
        `;

      } catch (error) {
        console.error('Erro:', error);
      }
    }

    function switchTab(tabName) {
      // Ocultar todos os tabs
      document.querySelectorAll('.tab-content').forEach(el => {
        el.classList.remove('active');
      });

      // Remover active dos bot√µes
      document.querySelectorAll('.tab').forEach(el => {
        el.classList.remove('active');
      });

      // Mostrar tab selecionado
      document.getElementById(tabName).classList.add('active');

      // Marcar bot√£o como ativo
      event.target.classList.add('active');
    }

    function goBack() {
      window.history.back();
    }

    function editarCliente() {
      alert('Editar cliente em desenvolvimento');
    }

    function uploadDocumento() {
      alert('Upload de documento em desenvolvimento');
    }

    function downloadDocumento(id) {
      alert('Download de documento ' + id);
    }

    function novoProcesso() {
      alert('Novo processo em desenvolvimento');
    }

    function novaFatura() {
      alert('Nova fatura em desenvolvimento');
    }

    function novoContato() {
      alert('Novo contato em desenvolvimento');
    }

    function deleteContato(id) {
      alert('Deletar contato ' + id);
    }

    function saveSituacao(event) {
      event.preventDefault();
      alert('Situa√ß√£o salva com sucesso!');
      document.getElementById('situacaoResumo').value = '';
      document.getElementById('situacaoDescricao').value = '';
      loadSituacao();
    }
  </script>
</body>
</html>

